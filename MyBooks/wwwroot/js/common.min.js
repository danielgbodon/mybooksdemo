function html_entity_decode(n){return n.replace(/[<>'"]/g,function(n){return"&"+{"'":"apos",'"':"quot","&":"amp","<":"lt",">":"gt"}[n]+";"})}class MB_Paginator{static loadPagination(n,t,i,r,u){if($(n).html(""),t!=0){let f=Math.trunc(t/i),e=f<=5?f:7,o=r==1?"uk-disabled":"",s=r==f?"uk-disabled":"";$(n).append('<li class="'+o+'"><a onclick="'+u+"("+(r-1)+')"><i class="uk-icon-angle-double-left"><\/i><\/a><\/li>');let h=r-3<1?1:r-3,c=r+3>f?f:r+3;for(let t=h;t<c;t++){let i=r==t?"uk-active":"";$(n).append('<li class="'+i+'"><a onclick="'+u+"("+t+')">'+t+"<\/a><\/li>")}if(f>e){let t=r==f?"uk-active":"";$(n).append("<li><span>&hellip;<\/span><\/li>");$(n).append('<li class="'+t+'"><a onclick="'+u+"("+f+')">'+f+"<\/a><\/li>")}$(n).append('<li class="'+s+'"><a onclick="'+u+"("+(r+1)+')"><i class="uk-icon-angle-double-right"><\/i><\/a><\/li>')}}}MB_Book={infoModalSelector:"#bookInfoModal",bookCardTemplateSelector:"#bookCardTemplate",bookCardMiniTemplateSelector:"#bookCardMiniTemplate",bookListItemViewSelector:"#bookListItemView",search:function(n,t,i,r,u){$.ajax({type:"GET",contentType:"application/json; charset=utf-8",url:"/api/book",data:{search:n,page:t},datatype:"json",success:function(n){i(n)},error:function(n,t,i){r!=undefined&&r(n,t,i)},complete:function(){u!=undefined&&u()}})},addCardView:function(n,t){let r=$(MB_Book.bookCardTemplateSelector).clone(),i=r.prop("content");$(i).find(".mb_book_title").html(t.title);$(i).find(".mb_book_author").html(t.authors==null?"Autor desconocido":t.authors.join(", "));$(i).find(".mb_book_desc").html(t.description==null?"":t.description);$(i).find(".mb_book_img").attr("src",t.smallImage).attr("alt",t.title);$(i).find(".mb_book_id_item").attr("data-book-id",t.id);MB_StartRating.load(t.stars,t.ratings,$(i).find(".mb_start_rating_view"));$(n).append(i);MB_BookList.buttonChangeAppearance(t.id,t.userBookListId)},cardClick:function(n){MB_Book.showInfoModal($(n).closest(".mb_book_card"))},addCardMiniView:function(n,t,i){let f=$(MB_Book.bookCardMiniTemplateSelector).clone(),r=f.prop("content");$(r).find(".mb_book_card_mini").attr("data-book-id",t.id);$(r).find(".mb_book_title").html(t.title);let e=$.parseHTML($("<div/>").html(t.description).text());$(r).find(".mb_book_desc").html(e);$(r).find(".mb_book_author").html(t.authors==null?"Autor desconocido":t.authors.join(", "));$(r).find(".mb_book_img").attr("src",t.image).attr("alt",t.title);let u=r;i!=undefined&&(u=document.createElement(i),u.appendChild(r));$(n).append(u)},getListItemView:function(n){let r=$(MB_Book.bookListItemViewSelector).clone(),t=r.prop("content");$(t).find(".mb_book_title").html(n.title);$(t).find(".mb_book_author").html(n.authors==null?"Autor desconocido":n.authors.join(", "));$(t).find(".mb_book_img").attr("src",n.image).attr("alt",n.title);var i=document.createElement("div");return i.append(t),$(i).html()},showInfoModal:function(n){let i=$(n).attr("data-book-id"),r=$(n).find(".mb_book_img").attr("src"),t=$(n).find(".mb_book_title").html(),u=$(n).find(".mb_book_author").html(),f=$.parseHTML($(n).find(".mb_book_desc").html());$(MB_Book.infoModalSelector).find(".mb_book_img").attr("src",r).attr("alt",t);$(MB_Book.infoModalSelector).find(".mb_book_title").html(t);$(MB_Book.infoModalSelector).find(".mb_book_author").html(u);$(MB_Book.infoModalSelector).find(".mb_book_desc").html(f);$(MB_Book.infoModalSelector).find("#btnViewDetails").attr("data-book-id",i);UIkit.modal(MB_Book.infoModalSelector).show()},viewDetails:function(n){let t=$(n).attr("data-book-id");window.location.href="/book/details/"+t},viewReview:function(n){let t=$(n).data("book-id");console.log("See opinions "+t)}};MB_Book_SearchSelector={init:function(n,t){$(n).selectize({valueField:"id",labelField:"title",searchField:"title",options:[],create:!1,persist:!1,dropdownOffsetTop:50,placeholder:Translator.BuscaAquiLibro+"...",render:{option:function(n){return MB_Book.getListItemView(n)}},load:function(t,i){let r=$(n).closest(".uk-grid").find(".mb_btn_delete");if(t.length<3)return MB_Book_SearchSelector.clean(r[0]),i();let u=$(n).closest(".uk-grid").find(".md-preloader"),f=$(r).css("display");r.css("display","none");u.css("display","block");MB_Book.search(t,0,function(n){i(n.items)},i(),function(){r.css("display",f);u.css("display","none");$(n+" .selectize-dropdown-content").animate({scrollTop:0},"slow")})},onChange:function(i){let r=this.options[i];t!=undefined&&t(i,r);$(n).closest(".uk-grid").find(".mb_btn_delete").css("display",i==""?"none":"block")}})},clean:function(n){var i=$(n).closest(".uk-grid").find("select.mb_book_search_selector").selectize(),t=i[0].selectize;t.options.length!=0&&(t.clear(),t.clearOptions())}};MB_BookList={formSelector:"#formBookList",modalSelector:"#modalAddBookList",callbackFunction:undefined,initFormModal:function(n){$(MB_BookList.formSelector+" #colorError").css("visibility","hidden");MB_ColorPalette.init(MB_BookList.formSelector+" #bookListColorPalette");$(MB_BookList.formSelector).submit(function(t){(t.preventDefault(),MB_ColorPalette.verificate("#bookListColorPalette"))&&($(MB_BookList.formSelector+' input[name$="Id"]').val()==""?MB_BookList.add(n):MB_BookList.edit(n))});$(document).on("keypress",MB_BookList.formSelector+" input",function(){event.which==13&&(event.preventDefault(),$(MB_BookList.formSelector).submit())})},add:function(){let n=$(MB_BookList.formSelector),t=n.serialize();n.find(":submit").addClass("disabled").attr("disabled");$.ajax({type:"post",url:"/api/booklist",data:t,datatype:"json",success:function(t){$(MB_BookList.modalSelector).find("button.uk-close").click();MB_BookList.callbackFunction!=undefined&&MB_BookList.callbackFunction(t.result);n.find('input[name="__RequestVerificationToken"]').val(t.verificationToken);let i=n.find('input[name="BookId"]').val()},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){n.find(":submit").removeClass("disabled").removeAttr("disabled")}})},addListBookAndBook:function(n){let t=$(n).attr("data-book-id");$('#formBookList input[name$="BookId"]').val(t);MB_BookList.callbackFunction=function(i){console.log(n);$(n).closest(".uk-nav-dropdown").find("#firstDefaultElement").before('<li><a class="mb_book_id_item uk-dropdown-close" data-book-id="'+t+'" data-list-color="'+i.color+'" data-list-id="'+i.id+'" onclick="MB_BookList.addToList(this)"><i class="uk-icon-circle uk-margin-small-right" style="color: '+i.color+'"><\/i><span id="listName">'+i.name+"<\/span><\/a><\/li>");MB_BookList.buttonChangeAppearance(t,i.id)};UIkit.modal(MB_BookList.modalSelector).show()},edit:function(){let n=$(MB_BookList.formSelector),t=n.serialize();n.find(":submit").addClass("disabled").attr("disabled");$.ajax({type:"put",url:"/api/booklist",data:t,datatype:"json",success:function(t){if(n.find('input[name="__RequestVerificationToken"]').val(t.verificationToken),t.code>0){MB_Error_Handler.notificate(t);return}MB_BookList.callbackFunction!=undefined&&MB_BookList.callbackFunction(t.result)},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){n.find(":submit").removeClass("disabled").removeAttr("disabled")}})},reorder:function(n,t){$.ajax({type:"put",url:"/api/booklist/reorder",data:{OrderedIds:n},datatype:"json",success:function(n){if(n.code!=0){MB_Error_Handler.notificate(n);return}$(MB_BookList.modalSelector).find("button.uk-close").click();t!=undefined&&t(n.result)},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){}})},"delete":function(n,t){$.ajax({type:"delete",url:"/api/booklist",data:{id:n},datatype:"json",success:function(n){t!=undefined&&t(n.result)},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){}})},showToAdd:function(n){let t=$(MB_BookList.formSelector),i=$('input[name$="BookId"]').val(),r=t.find('input[name="__RequestVerificationToken"]').val();t.find("input").val("");t.find('input[name$="BookId"]').val(i);t.find('input[name="__RequestVerificationToken"]').val(r);t.find(".md-input-success").removeClass("md-input-success");t.find(".md-input-filled").removeClass("md-input-filled");t.find("#colorPalette .k-state-selected").removeClass("k-state-selected");t.find(":submit").html(Translator.CrearLista);MB_BookList.callbackFunction=n;UIkit.modal(MB_BookList.modalSelector).show()},showToEdit:function(n,t){let i=$(MB_BookList.formSelector);i.find('input[name$="Id"]').val(n.id);i.find('input[name$="BookId"]').val("");i.find('input[name$="Name"]').val(n.name);i.find('input[name$="Name"]').closest("div.md-input-wrapper").addClass("md-input-filled").addClass("md-input-wrapper-success");i.find("#colorPalette .k-state-selected").removeClass("k-state-selected");i.find('#colorPalette td[aria-label$="'+n.color.toLowerCase()+'"]').addClass("k-state-selected");i.find('input[name$="Color"]').val(n.color.toLowerCase());i.find(":submit").html(Translator.GuardarCambios);MB_BookList.callbackFunction=t;UIkit.modal(MB_BookList.modalSelector).show()},addToList:function(n){let t=$(n).data("book-id"),r=$(n).data("list-id"),i=$("#btnAddLibroLista[data-book-id='"+t+"']");i.addClass("disabled").attr("disabled");$.ajax({type:"post",url:"/api/booklist/book",data:{BookId:t,BookListId:r},datatype:"json",success:function(n){if(n.code>0){MB_Error_Handler.notificate(n);return}MB_BookList.buttonChangeAppearance(t,n.result.id)},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){i.removeClass("disabled").removeAttr("disabled")}})},deleteToList:function(n){let t=$(n).attr("data-book-id"),r=$(n).attr("data-list-id"),i=$("#btnAddLibroLista[data-book-id='"+t+"']");i.addClass("disabled").attr("disabled");$.ajax({type:"delete",url:"/api/booklist/book",data:{BookId:t,BookListId:r},datatype:"json",success:function(n){if(n.code!=0){MB_Error_Handler.notificate(n);return}MB_BookList.buttonChangeAppearance(t,0)},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){i.removeClass("disabled").removeAttr("disabled")}})},buttonChangeAppearance:function(n,t){let i=$('#btnAddLibroLista[data-book-id="'+n+'"]'),r=Translator.AnadirLibroLista,u="#9e9e9e",f="none";if(t>0){let n=i.siblings(".uk-dropdown").find('li a[data-list-id="'+t+'"]');r=n.find("#listName").html();u=n.data("list-color");f="inherit"}i.find("#listName").html(r);i.css("background",u);i.siblings(".uk-dropdown").find(".deleteToListElement").css("display",f);i.siblings(".uk-dropdown").find("li.deleteToListElement a").attr("data-list-id",t)}};MB_BookList_Slider={sliderTemplateSelector:"#bookListSlider",add:function(n,t){let r=$(MB_BookList_Slider.sliderTemplateSelector).clone(),i=r.prop("content");if($(i).find(".uk-nestable-item").attr("data-book-list-id",t.id),$(i).find(".uk-nestable-item").attr("data-book-list-name",t.name),$(i).find("#listName").html(t.name),$(i).find(".uk-nestable-item").attr("data-book-list-color",t.color),$(i).find(".uk-nestable-panel").css("background",t.color),$(i).find(".uk-nestable-item").attr("data-book-list-removable",t.removable),t.removable==0&&$(i).find("#actionsButtons").remove(),t.books.length>0){let n=$(i).find("ul.uk-slider");console.log(n);$(n).css("display","inherit");t.books.forEach(function(t){MB_Book.addCardMiniView(n,t,"LI")})}else $(i).find("#emptyBookListContainer").css("display","inherit");$(n).append(i)},edit:function(n,t){let i=$(n+' li.mb_book_list_slider[data-book-list-id="'+t.id+'"]');i.attr("data-book-list-color",t.color);i.find(".uk-nestable-panel").css("background",t.color);i.attr("data-book-list-name",t.name);i.find("#listName").html(t.name)},"delete":function(n,t){$(n+' li.mb_book_list_slider[data-book-list-id="'+t+'"]').remove()}};MB_StartRating={load:function(n,t,i){i==undefined&&(i=".mb_start_rating_view");$(i).attr("data-stars",n);$(i).attr("data-reviews",t);let r=$(i).find(".mb_stars_rating"),u=$(i).find(".mb_num_rating");if(t==0){r.css("display","none");u.html(Translator.SinOpiniones);return}r.css("display","inline");u.html(t+" "+(t==1?Translator.Opinion:Translator.Opiniones));let f=Math.trunc(n),e=n-Math.trunc(n);r.children("i").each(function(t){if(f>t){$(this).removeClass("uk-icon-star-o").removeClass("uk-icon-star-half-empty").addClass("uk-icon-star");return}if(t<n&&e>=.5){$(this).removeClass("uk-icon-star-o").removeClass("uk-icon-star").addClass("uk-icon-star-half-empty");return}$(this).removeClass("uk-icon-star-half-empty").removeClass("uk-icon-star").addClass("uk-icon-star-o")})}};class MB_ListGridView{constructor(n){this.selListGrid="#listaLibros_"+n;this.selListGridToggle="#list_grid_toggle_"+n;this.selPagination=".mb_pagination_pages_"+n;this.selNoResults="#listGridNoResults_"+n}init(){let i=$(this.selListGridToggle).children("li"),n=$(this.selListGrid),t=MB_LocalStorage.load("ListGridViewDefault");t==null&&(t="grid_view");n.addClass(t);$(this.selListGridToggle).find('li[data-view="'+t+'"]').addClass("uk-active");console.log($(this.selListGridToggle).find('li[data-view="'+t+'"]'));n.each(function(){$(this).hasClass("uk-active")&&n.addClass(i.attr("data-view"))});i.on("click",function(t){var i,u,r;t.preventDefault();i=$(this);u=i.hasClass("uk-active");u||(r=i.attr("data-view"),r=="list_view"?n.addClass("list_view").removeClass("grid_view"):n.addClass("grid_view").removeClass("list_view"),MB_LocalStorage.save("ListGridViewDefault",r),i.addClass("uk-active").siblings().removeClass("uk-active"))})}loadGridView(n,t){if(MB_Paginator.loadPagination(this.selPagination,n.totalItems,n.elementsPerPage,n.currentPage,"searchBooks"),n.totalItems==0){$(this.selListGrid).css("display","none");$(this.selNoResults).css("display","block");return}$(this.selNoResults).css("display","none");$(this.listGridNoResults).css("display","none");$(this.selListGrid).html("");let i=this.selListGrid;n.items.forEach(function(n){t(i,n)})}}MB_ColorPalette={init:function(n,t=""){t==""&&(t="Color");$(n+" #inputColorPalette").attr("name",t);$(n+" #colorPaletteError").css("visibility","hidden");var i=$(n+" #colorPalette");i.length&&i.kendoColorPalette({columns:20,tileSize:{width:32,height:24},palette:["#e53935","#d81b60","#8e24aa","#5e35b1","#3949ab","#1e88e5","#039be5","#00acc1","#00897b","#43a047","#7cb342","#c0ca33","#fdd835","#ffb300","#fb8c00","#f4511e","#6d4c41","#757575","#546e7a"],change:function(t){$(n+" #colorPaletteError").css("visibility","hidden");$(n+" #inputColorPalette").val(t.value)}});$(document).on(n+" #inputColorPalette","change",function(){console.log("Ha cambiado el change")});$(n+" #inputColorPalette").change(function(){alert("The text has been changed.")})},verificate:function(n){return $(n+" #inputColorPalette").val()==""?($(n+" #colorPaletteError").css("visibility","visible"),!1):($(n+" #colorPaletteError").css("visibility","hidden"),!0)}};MB_Notification={show:function(n,t,i){if(n!=undefined&&(thisNotify=UIkit.notify({message:n,status:t==undefined?"info":t,timeout:5e3,group:null,pos:"bottom-right",onClose:function(){$body.find(".md-fab-wrapper").css("margin-bottom","");i!=undefined&&i;clearTimeout(thisNotify.timeout)}}),$window.width()<768&&(thisNotify.options.pos=="bottom-right"||thisNotify.options.pos=="bottom-left"||thisNotify.options.pos=="bottom-center")||thisNotify.options.pos=="bottom-right")){var r=$(thisNotify.element).outerHeight(),u=$window.width()<768?-6:8;$body.find(".md-fab-wrapper").css("margin-bottom",r+u)}}};MB_Modal={confirm:function(n,t,i,r){if(n!=undefined&&n!=null){(i==undefined||i==null)&&(i="Sí");(r==undefined||r==null)&&(r="Cancelar");var u=UIkit.modal.confirm(n,t,{labels:{Ok:i,Cancel:r}});u.show()}},alert:function(n,t,i){if(n!=undefined&&n!=null){(i==undefined||i==null)&&(i="Entendido");var r=UIkit.modal.alert(n,{labels:{Ok:i}}).on({"hide.uk.modal":function(){t!=undefined&&t()}});r.show()}}};MB_LocalStorage={storage:window.localStorage,save:function(n,t){try{MB_LocalStorage.storage.setItem(n,t)}catch(i){console.log(i)}},load:function(n){try{return MB_LocalStorage.storage.getItem(n)}catch(t){alert("Please go away")}},"delete":function(){try{MB_LocalStorage.storage.removeItem("")}catch(n){console.log(n)}}};MB_Scroll={toTop:function(){$(window).scrollTop(0)},toBottomAnimate:function(){$("html, body").animate({scrollTop:$(document).height()},1e3)}};MB_User={changeCulture:function(n){let t=$(n),i=t.serialize();$.ajax({type:"put",url:"/api/user/culture",data:i,datatype:"json",success:function(n){if(n.code>0){t.find('input[name="__RequestVerificationToken"]').val(n.verificationToken);MB_Error_Handler.notificate(n);return}location.reload()},error:function(n){MB_Error_Handler.notificate(n)},complete:function(){t.find(":submit").removeClass("disabled").removeAttr("disabled")}})}};MB_Error_Handler={notificate:function(n){let t="";(n.message!=undefined?t=n.message:n.responseJSON!=undefined&&n.responseJSON.errors!=undefined?n.responseJSON.errors!=undefined&&(t+=Object.values(n.responseJSON.errors).join("<br/>")):n.responseText!=undefined&&(t=n.responseText),t!="")&&MB_Notification.show(t,"danger")}};